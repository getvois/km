{% extends 'SandboxWebsiteBundle:Layout:layout.html.twig' %}

{% block mainBgUrl %}
    {% if page.topImage is not null and page.topImage.picture is not null %}{{ page.topImage.picture.url }}{% else %}
        {{ render(controller('SandboxWebsiteBundle:Travelbase:getRandomImageUrl')) }}{% endif %}
{% endblock %}

{% block topImgTitle %}
    {% if page.topImage is not null and page.topImage.picture is not null %}
        {{ render(controller('SandboxWebsiteBundle:Travelbase:getRandomImageTitle', { 'image': page.topImage})) }}
    {% else %}
        {{ render(controller('SandboxWebsiteBundle:Travelbase:getRandomImageTitle')) }}
    {% endif %}
{% endblock %}

{% block sidebar %}
    <div class="">
        {% if page.title != 'Countries' or page.title != 'Places' %}
        <h2>{{ page.title }}</h2>
        {% endif %}
        {#{#{{ render_pageparts(page, 'main') }}#}
        {#{% set count = 0 %}#}
        {#{# 1 level #}
        {#{% if places > 0 %}#}
            {#<ul class="article__overview--list">#}
                {#{% for article in places %}#}
                    {#{% if host and article.node.refEntityName != "Sandbox\\WebsiteBundle\\Entity\\Pages\\content" %}#}
                        {#{% if host in article.publicNodeVersion.getRef(em).hosts %}#}
                            {#{% if article.node.refEntityName == "Sandbox\\WebsiteBundle\\Entity\\Place\\PlaceOverviewPage" %}#}
                                {#<li class="article__overview--list-item">#}
                                    {#{#{{ dump(article) }}#}
                                    {#{#{{ dump(article.publicNodeVersion.getRef(em)) }}#}
                                    {#{#{% set articlenode = get_node_translation_for(article) %}#}
                                    {#<h4><a href="{{ path('_slug', { 'url': article.url }) }}">{{ article.title }}</a></h4>#}
                                    {#{# 2 level #}
                                    {#{% if article.node.children.count > 0 %}#}
                                        {#<ul class="article__overview--list">#}
                                            {#{% for node in article.node.children if node.refEntityName == "Sandbox\\WebsiteBundle\\Entity\\Place\\PlaceOverviewPage" and node.NodeTranslation(lang) %}#}
                                                {#{% if host in node.NodeTranslation(lang).publicNodeVersion.getRef(em).hosts %}#}
                                                    {#<li class="article__overview--list-item">#}
                                                        {#<h5><a href="{{ node.NodeTranslation(lang).url }}">{{ node.NodeTranslation(lang).title }}</a></h5>#}

                                                        {#{# 3 level #}
                                                        {#{% if node.children.count > 0 %}#}
                                                            {#<ul class="article__overview--list">#}
                                                                {#{% for node2 in node.children if node2.refEntityName == "Sandbox\\WebsiteBundle\\Entity\\Place\\PlaceOverviewPage" %}#}
                                                                    {#{% if host in node2.NodeTranslation(lang).publicNodeVersion.getRef(em).hosts %}#}
                                                                        {#<li class="article__overview--list-item">#}
                                                                            {#<h5><a href="{{ node2.NodeTranslation(lang).url }}">{{ node2.NodeTranslation(lang).title }}</a></h5>#}
                                                                        {#</li>#}
                                                                    {#{% endif %}#}
                                                                {#{% endfor %}#}
                                                            {#</ul>#}
                                                        {#{% endif %}#}
                                                    {#</li>#}
                                                {#{% endif %}#}
                                            {#{% endfor %}#}
                                        {#</ul>#}
                                    {#{% endif %}#}

                                    {#{#{{ article.summary }}#}
                                    {#{#<time>{{ article.date | date("d/m/Y")}}</time>#}
                                {#</li>#}
                            {#{% endif %}#}
                        {#{% endif %}#}
                    {#{% else %}#}
                        {#{% if article.node.refEntityName == "Sandbox\\WebsiteBundle\\Entity\\Place\\PlaceOverviewPage" %}#}
                            {#<li class="article__overview--list-item">#}
                                {#{#{{ dump(article) }}#}
                                {#{#{{ dump(article.publicNodeVersion.getRef(em)) }}#}
                                {#{#{% set articlenode = get_node_translation_for(article) %}#}
                                {#<h4><a href="{{ path('_slug', { 'url': article.url }) }}">{{ article.title }}</a></h4>#}
                                {#{# 2 level #}
                                {#{% if article.node.children.count > 0 %}#}
                                    {#<ul class="article__overview--list">#}
                                        {#{% for node in article.node.children if node.refEntityName == "Sandbox\\WebsiteBundle\\Entity\\Place\\PlaceOverviewPage" %}#}
                                            {#{% if node.NodeTranslation(lang) %}#}
                                                {#<li class="article__overview--list-item">#}
                                                    {#<h5><a href="{{ node.NodeTranslation(lang).url }}">{{ node.NodeTranslation(lang).title }}</a></h5>#}

                                                    {#{# 3 level #}
                                                    {#{% if node.children.count > 0 %}#}
                                                        {#<ul class="article__overview--list">#}
                                                            {#{% for node2 in node.children if node2.refEntityName == "Sandbox\\WebsiteBundle\\Entity\\Place\\PlaceOverviewPage" %}#}
                                                                {#<li class="article__overview--list-item">#}
                                                                    {#<h5><a href="{{ node2.NodeTranslation(lang).url }}">{{ node2.NodeTranslation(lang).title }}</a></h5>#}


                                                                {#</li>#}
                                                            {#{% endfor %}#}
                                                        {#</ul>#}
                                                    {#{% endif %}#}

                                                {#</li>#}
                                            {#{% endif %}#}
                                        {#{% endfor %}#}
                                    {#</ul>#}
                                {#{% endif %}#}

                                {#{#{{ article.summary }}#}
                                {#{#<time>{{ article.date | date("d/m/Y")}}</time>#}
                            {#</li>#}
                        {#{% endif %}#}
                    {#{% endif %}#}


                    {#{% set count = count + 1 %}#}
                {#{% endfor %}#}
            {#</ul>#}
            {#{#{% if pagerfanta.haveToPaginate() %}#}
            {#{#{{ pagerfanta(pagerfanta) }}#}
            {#{#{% endif %}#}
        {#{% endif %}#}






















        {#{{ render_pageparts(page, 'main') }}#}
        {% set count = 0 %}
        {# 1 level #}
        {% if places > 0 %}
                {% for article in places %}
                    {% if host
                    and article.node.refEntityName != "Sandbox\\WebsiteBundle\\Entity\\Pages\\ContentPage"
                    and article.node.refEntityName != "Sandbox\\WebsiteBundle\\Entity\\Pages\\CompanyPlacePage"

                    %}
                        {% if host in article.publicNodeVersion.getRef(em).hosts %}
                            {% if article.node.refEntityName != "Sandbox\\WebsiteBundle\\Entity\\Place\\PlaceOverviewPage" %}
                                <h2><a href="{{ path('_slug', { 'url': article.url }) }}">{{ article.title }}</a></h2>
                                {#<ul class="company--list">#}
                                {#<li class="article__overview--list-item">#}
                                    {#{{ dump(article) }}#}
                                    {#{{ dump(article.publicNodeVersion.getRef(em)) }}#}
                                    {#{% set articlenode = get_node_translation_for(article) %}#}
                                    {# 2 level #}
                                    {% if article.node.children.count > 0 %}
                                        <ul class="article__overview--list">
                                            {% for node in article.node.children if node.refEntityName != "Sandbox\\WebsiteBundle\\Entity\\Place\\PlaceOverviewPage" %}
                                                {% if host in node.NodeTranslation(lang).publicNodeVersion.getRef(em).hosts %}
                                                    <li class="article__overview--list-item">
                                                        <h5>asfs<a href="/{{ node.NodeTranslation(lang).url }}">{{ node.NodeTranslation(lang).title }}</a></h5>

                                                        {#{# 3 level #}#}
                                                        {#{% if node.children.count > 0 %}#}
                                                            {#<ul class="article__overview--list">#}
                                                                {#{% for node2 in node.children if node2.refEntityName != "Sandbox\\WebsiteBundle\\Entity\\Place\\PlaceOverviewPage" %}#}
                                                                    {#{% if host in node2.NodeTranslation(lang).publicNodeVersion.getRef(em).hosts %}#}
                                                                        {#<li class="article__overview--list-item">#}
                                                                            {#<h5><a href="{{ node2.NodeTranslation(lang).url }}">{{ node2.NodeTranslation(lang).title }}</a></h5>#}
                                                                        {#</li>#}
                                                                    {#{% endif %}#}
                                                                {#{% endfor %}#}
                                                            {#</ul>#}
                                                        {#{% endif %}#}
                                                    </li>
                                                {% endif %}
                                            {% endfor %}
                                        </ul>
                                    {% endif %}

                                    {#{{ article.summary }}#}
                                    {#<time>{{ article.date | date("d/m/Y")}}</time>#}
                                {#</li>#}
                            {% endif %}
                        {% endif %}
                    {% else %}
                        {% if article.node.refEntityName != "Sandbox\\WebsiteBundle\\Entity\\Place\\PlaceOverviewPage" %}
                                <h2><a href="{{ path('_slug', { 'url': article.url }) }}">{{ article.title }}</a></h2>
                                    {#<ul class="company--list">#}
                            {#<li class="article__overview--list-item">#}
                                {#{{ dump(article) }}#}
                                {#{{ dump(article.publicNodeVersion.getRef(em)) }}#}
                                {#{% set articlenode = get_node_translation_for(article) %}#}
                                {# 2 level #}
                                {% if article.node.children.count > 0 %}
                                    <ul class="article__overview--list">
                                        {% for node in article.node.children if node.refEntityName != "Sandbox\\WebsiteBundle\\Entity\\Place\\PlaceOverviewPage" %}
                                            {% if node.NodeTranslation(lang) %}
                                                <li class="article__overview--list-item">
                                                    <h5><a href="{{ node.NodeTranslation(lang).url }}">{{ node.NodeTranslation(lang).title }}</a></h5>

                                                    {# 3 level #}
                                                    {#{% if node.children.count > 0 %}#}
                                                        {#<ul class="article__overview--list">#}
                                                            {#{% for node2 in node.children if node2.refEntityName != "Sandbox\\WebsiteBundle\\Entity\\Place\\PlaceOverviewPage" %}#}
                                                                {#<li class="article__overview--list-item">#}
                                                                    {#<h5><a href="{{ node2.NodeTranslation(lang).url }}">{{ node2.NodeTranslation(lang).title }}</a></h5>#}


                                                                {#</li>#}
                                                            {#{% endfor %}#}
                                                        {#</ul>#}
                                                    {#{% endif %}#}

                                                </li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                                {% endif %}

                                {#{{ article.summary }}#}
                                {#<time>{{ article.date | date("d/m/Y")}}</time>#}
                            {#</li>#}
                        {% endif %}
                    {% endif %}


                    {% set count = count + 1 %}
                {% endfor %}
            {#</ul>#}
            {#{% if pagerfanta.haveToPaginate() %}#}
            {#{{ pagerfanta(pagerfanta) }}#}
            {#{% endif %}#}
        {% endif %}






















        {{ render(controller('SandboxWebsiteBundle:Subscription:subscribeForm', {'page' : page})) }}

        {% if preferredtags is defined %}
            <div class="tags-block">
                <h2>Tags</h2>
                {% for tag in tags %}
                    <div>
                        <a href="{{ app.request.requestUri ~ "/" ~ tag.name | replace({' ': "_"}) }}">{{ tag.name }}</a>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% if preferredtags is defined %}
            <div class="preferred-tags-block">
                <h2>Categories</h2>
                {% for pt in preferredtags %}
                    {% if pt.tag is not null %}
                        <div class="{{ pt.class }}">
                            <a href="{{ app.request.requestUri ~ "/" ~ pt.tag.name | replace({' ': "_"}) }}">{{ pt.tag.name }}</a>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}

    </div>
{% endblock %}

{% block content %}

    {% include '@SandboxWebsite/SeoModule/top.html.twig' %}

    <div role="tabpanel">
        <div class="newspage col-md-7">
				<!-- News pane -->
                {% if news is not null %}
                    {% if news > 0 %}
                        
                        <h1>Latest offers</h1>
                        {% for item in news %}
						<article class="main-article main-article--summary">	
                        
				   			
				   		
                            {% set articlenode = get_node_translation_for(item) %}
                            {#{{ dump(item) }}#}
                                <header>
                                    <time class="main-article__meta">
                                        {{ item.date | date("d.m.Y") }}
                                    </time>
                                    <h4 class="main-article__title">
                                        {% if item.priceFrom %}<div class="pull-right"><div class="price-from price-from-img"><div class="price-from-inner pull-right"><span style="font-size:16px;">{{ item.priceFrom }}</span></div></div></div>{% endif %}
			        					<a href="/{{ lang }}/{{ articlenode.url }}">{{ item.title }}</a>
                                    </h4>
                                </header>
                                {% if item.image %}<div class="row">{% endif %}
                                <div class="{% if item.imgSize %}col-md-12{% else %}col-md-9{% endif %}">
                                {{ item.summary }}
                                <p>
                                    <a href="/{{ lang }}/{{ articlenode.url }}" class="btn btn-primary main-article__readmore">
                                        Read more
                                    </a>
                                </p>  
                                {% if item.image %}  
                                </div>
						        <div class="col-md-3">
						        	<br />
						        	<a href="/{{ lang }}/{{ articlenode.url }}"><img src="{{ asset(item.image.url | imagine_filter("300x")) }}" alt="" class="img-responsive pull-right"/></a>
					   			</div>
			   					{% endif %}
                                {% if item.image %}</div>{% endif %}
                             
                        </article>  
                        {% endfor %}
                        
                    {% endif %}
                {% else %} 
                    No news
                {% endif %}
                </div>
                <div class="content col-md-5">  
                <!-- Articles pane -->
                {% if articles is not null %}
                    {% if articles > 0 %}
						<h1>Articles</h1>    
                        {% for item in articles %}
                            {% set articlenode = get_node_translation_for(item) %}
                            {#{{ dump(item) }}#}
							<article class="main-article main-article--summary article__overview--list-item"> 
								<header>
	                               {% if item.places.count > 0 %}
								        <div class="to-places pull-right">
								        <span class="glyphicon glyphicon-map-marker"></span>
								        {% for place in item.places %}
                                            {% if get_node_translation_for(place) %}
								                <a href="{{ path("_slug", { 'url' : get_node_translation_for(place).fullSlug }) }}">{{ place.title }}</a> {% if loop.last == false %}/{% endif %}
                                            {% endif %}
								        {% endfor %}
								        </div>
								    {% endif %}
		    
		    						<time>{{ item.date | date("F jS H:i")}}</time>
                            	
                                    <h3>
                                        {% if item.priceFrom %}<div class="pull-right"><div class="price-from price-from-img"><div class="price-from-inner pull-right"><span>{{ item.priceFrom }}</span></div></div></div>{% endif %}
                    					<a href="/{{ lang }}/{{ articlenode.url }}">{{ item.title }}</a>
                                    </h3>
                            	</header>
                                {% if item.image %}
		                            {% if item.imgSize == '300l' %}
		               	 				<img src="{{ asset(item.image.url | imagine_filter("300x")) }}" alt="" class="img-responsive pull-left"/>
		                            {% elseif item.imgSize == '300r' %}
		                				<img src="{{ asset(item.image.url | imagine_filter("300x")) }}" alt="" class="img-responsive pull-right"/>
		                            {% endif %}
		                        {% endif %}
                                
                               
                                {% if item.image %}
                                    {% if item.imgSize == '1000' %}
                                        <a href="/{{ lang }}/{{ articlenode.url }}"><img src="{{ asset(item.image.url | imagine_filter("1000x")) }}" alt="" class="img-responsive"/></a>
                                    {% endif %}
                                {% endif %}
                                <p></p>
                                <p>{{ item.summary }}</p>
                                <p>
                                    <a href="/{{ lang }}/{{ articlenode.url }}" class="btn btn-primary main-article__readmore">
                                        Read more
                                    </a>
                                </p>
                                <div class="clear"></div>
                            </article>

                            {#<div class="news">#}
                            {#<h4 class="title">#}
                            {#<a href="/{{ lang }}/{{ articlenode.url }}">{{ item.title }} <span class="date">{{ item.date | date("d/m/Y") }}</span></a>#}
                            {#</h4>#}
                            {#<p class="summary">#}
                            {#{{ item.summary }}#}
                            {#</p>#}
                            {#</div>#}
                        {% endfor %}
                    {% endif %}
                {% else %}
                    No articles
                {% endif %}
                </div>
    </div>

    {% include '@SandboxWebsite/SeoModule/bottom.html.twig' %}

{% endblock %}
{% block seoFooter %}
    {% include "@SandboxWebsite/SeoModule/footer.html.twig" %}
{% endblock %}

